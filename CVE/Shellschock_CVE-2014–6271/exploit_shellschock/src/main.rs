use clap::Parser;
use std::net::IpAddr;

/// Exploit the Shellshock CVE-2014â€“6271
#[derive(Parser, Debug)]
#[command(version)]
struct Args {
    /// Target IP
    #[arg(long)]
    ip: IpAddr,

    /// Command you want to execute
    #[arg(short, long)]
    command: Option<String>,

    /// Obtain Remote Control Execution
    #[arg(long, default_value_t = false)]
    rce: bool,
}

fn main() {
    let args = Args::parse();

    // Verifica che solo uno tra --command e --rce sia fornito
    if args.command.is_some() && args.rce {
        eprintln!("\n[!] Error: Only one of '--command' or '--rce' can be specified, not both.\n");
        std::process::exit(1);
    }

    // Verifica che almeno uno dei due parametri sia fornito
    if args.command.is_none() && !args.rce {
        eprintln!("\n[!] Error: Either '--command' or '--rce' must be specified.\n");
        std::process::exit(1);
    }

    // Continua con la logica del programma
    println!("Target IP: {}", args.ip);

    if let Some(command) = args.command {
        println!("Command: {}", command);
    } else if args.rce {
        println!("Remote Control Execution: {}", args.rce);
    }
}
